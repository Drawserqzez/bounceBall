let ball,HighScore,hs,highscorestable,PlayerName="Player",obstacles=[],paddleSpeed=10,paddleHits=0,speedchange=.4,Score=0;null!==window.localStorage.HighScore&&window.localStorage.HighScore>=0?HighScore=window.localStorage.HighScore:(window.localStorage.HighScore=0,HighScore=0);let canvasWidth=400;function preload(){hs=loadJSON("../gamehandler/gethighscores.php?gameid=1")}function setup(){setupGameBoard();let e=2,t=2;random(-1,1)<0&&(e*=-1),random(-1,1)<0&&(t*=-1),ball=new Ball(width/2,20,5,e,t),obstacles.push(new Paddle(20,width-40,60,10))}function draw(){background(0),stroke(255),ball.move(),ball.display(),0==ball.update()&&gameOver();for(let e=obstacles.length-1;e>=0;e--)obstacles[e].move(),obstacles[e].display();textSize(20),fill(255),Score>1e3&&noLoop(),textAlign(LEFT),text("Score: "+Score,20,30),textAlign(RIGHT),text("HighScore: "+HighScore,canvasWidth-20,30)}function setupGameBoard(){createCanvas(canvasWidth,canvasWidth).position(windowWidth/2-canvasWidth/2,200),textAlign(CENTER);let e=createDiv("Paddle Frenzy");e.class("title"),e.position(windowWidth/2-canvasWidth/2,50);let t=createDiv("<ul><li>Play with left and right arrows</li><li>The ball travels a little faster after every paddle touch</li><li>Now go get that highscore!</li><br><li>Press ENTER to reload</li></ul>");if(t.class("instructions"),t.position(100,200),null!==hs){let e=createDiv();e.class("Highscores"),e.position(windowWidth/2+canvasWidth/2+100,200);let t=createElement("h3","Highscores (WIP)");e.child(t);var i=createElement("table");let h=createElement("thead",'<tr><th style="text-align: left;">Player</th><th style="text-align: left;">Score</th></tr>');i.child(h);var s=createElement("tbody");for(var l in hs){let e=createElement("tr","<td>"+hs[l].playername+"</td><td>"+hs[l].score+"</td>");s.child(e)}i.child(s),e.child(i)}createElement("h3",PlayerName).position(windowWidth/2-canvasWidth/2,canvasWidth+210),createElement("form",'<input type="text" id="textbox" style="width: 100;" placeholder="Enter your Name"><button id="submit">Confirm Name</button>').position(windowWidth/2-canvasWidth/2,canvasWidth+260),document.getElementById("submit").addEventListener("click",(function(){window.localStorage.PlayerName=document.getElementById("textbox").value}))}function gameOver(){background(255,0,0),textAlign(CENTER),text("Game Over!",width/2,height/2-20),Score>HighScore&&text("New HighScore!",width/2,height/2+20),Score>HighScore&&(HighScore=Score,window.localStorage.HighScore=HighScore,h()),noLoop();let e=createButton("New Game");e.position(windowWidth/2-e.width/2,200+canvasWidth-100),e.mousePressed(e=>{location.reload()})}null!==window.localStorage.PlayerName&&(PlayerName=window.localStorage.PlayerName);class Ball{constructor(e,t,i,s,l){this.x=e,this.y=t,this.r=i,this.velX=s,this.velY=l,this.speedchange=speedchange}update(){if((this.velX>0&&this.x+this.r>=width||this.velX<0&&this.x-this.r<=0)&&(this.velX*=-1),this.velY<0&&this.y-this.r<=0&&(this.velY*=-1),this.velY>0&&this.y+this.r>=height)return!1;for(let e=obstacles.length-1;e>=0;e--)if(this.x+this.r+this.velX>obstacles[e].x&&this.x+this.velX<obstacles[e].x+obstacles[e].width&&this.y+this.r>obstacles[e].y&&this.y<obstacles[e].y+obstacles[e].height&&(this.velX*=-1),this.x+this.r>obstacles[e].x&&this.x<obstacles[e].x+obstacles[e].width&&this.y+this.r+this.velY>obstacles[e].y&&this.y+this.velY<obstacles[e].y+obstacles[e].height&&(this.velY*=-1,obstacles[e]instanceof Paddle)){Score+=10,paddleHits+=1,random(-1,1)<0?this.velX>0?this.velX+=this.speedchange:this.velX-=this.speedchange:this.velY>0?this.velY+=this.speedchange:this.velY-=this.speedchange}}move(){this.x+=this.velX,this.y+=this.velY}display(){ellipse(this.x,this.y,2*this.r,2*this.r)}}function keyTyped(){"r"===key&&(console.log("r"),window.localStorage.HighScore=0)}function keyPressed(){keyCode===ENTER&&location.reload()}function h(){fetch("../gamehandler/highscoreinsert.php?ga=1&is="+HighScore+"&sc="+Score+"&ph="+paddleHits+"&pn="+PlayerName,{method:"GET"}).then(e=>{console.log(e)}).catch(e=>console.log(JSON.parse(JSON.stringify(e))))}class Paddle{constructor(e,t,i,s){this.x=e,this.y=t,this.width=i,this.height=s}move(){keyIsDown(LEFT_ARROW)&&this.x>0?this.x-=paddleSpeed:keyIsDown(RIGHT_ARROW)&&this.x+this.width<width&&(this.x+=paddleSpeed)}display(){rect(this.x,this.y,this.width,this.height)}}