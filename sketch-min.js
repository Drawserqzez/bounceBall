let ball,hs,highscorestable,HighScore,paddles=[],topAlign=20,middleAlign=120,canvasSize=400,ps=10,ph=0,sc=.4,Score=0;null!==window.localStorage.HighScore&&window.localStorage.HighScore>=0?HighScore=window.localStorage.HighScore:(window.localStorage.HighScore=0,HighScore=0);let PlayerName="Player";function preload(){hs=loadJSON("../gamehandler/gethighscores.php?gameid=1")}function setup(){setupGameBoard();let e=random(-1,1)<0?-2:2,t=random(-1,1)<0?-2:2;ball=new Ball(width/2,20,5,e,t),paddles.push(new Paddle(20,width-40,60,10))}function draw(){background(0),stroke(255),ball.move(),ball.display(),0==ball.update()&&gameOver();for(let e=paddles.length-1;e>=0;e--)paddles[e].move(),paddles[e].display();textSize(20),fill(255),Score>1e3&&noLoop(),textAlign(LEFT),text("Score: "+Score,20,30),textAlign(RIGHT),text("HighScore: "+HighScore,canvasSize-20,30)}function setupGameBoard(){createCanvas(canvasSize,canvasSize).position(windowWidth/2-canvasSize/2,middleAlign),textAlign(CENTER);let e=createDiv("Paddle Frenzy");e.class("title"),e.position(windowWidth/2-canvasSize/2,topAlign);let t=createDiv("<ul><li>Play with left and right arrows or A & D</li><li>The ball travels a little faster after every paddle touch</li><li>Now go get that highscore!</li><br><li>Press ENTER to reload</li></ul>");if(t.class("instructions"),t.position(100,middleAlign),null!==hs){let e=createDiv();e.class("Highscores"),e.position(windowWidth/2+canvasSize/2+100,middleAlign);let t=createElement("h3","Highscores (WIP)");e.child(t);var i=createElement("table");let a=createElement("thead",'<tr><th style="text-align: left;">Player</th><th style="text-align: left;">Score</th></tr>');i.child(a);var l=createElement("tbody");for(var s in hs){let e=createElement("tr","<td>"+hs[s].playername+"</td><td>"+hs[s].score+"</td>");l.child(e)}i.child(l),e.child(i)}createElement("h3",PlayerName).position(windowWidth/2-canvasSize/2,middleAlign+canvasSize+5),createElement("form",'<input type="text" id="textbox" style="width: 100;" placeholder="Enter your Name"><button id="submit">Confirm Name</button>').position(windowWidth/2-canvasSize/2,middleAlign+canvasSize+55),document.getElementById("submit").addEventListener("click",(function(){window.localStorage.PlayerName=document.getElementById("textbox").value}))}function gameOver(){background(255,0,0),textAlign(CENTER),text("Game Over!",width/2,height/2-20),Score>HighScore&&text("New HighScore!",width/2,height/2+20),Score>HighScore&&(HighScore=Score,window.localStorage.HighScore=HighScore,h()),noLoop();let e=createButton("New Game");e.position(windowWidth/2-e.width/2,middleAlign+canvasSize-100),e.mousePressed(e=>{location.reload()})}null===window.localStorage.PlayerName&&""===window.localStorage.PlayerName||(PlayerName=window.localStorage.PlayerName);class Ball{constructor(e,t,i,l,s){this.x=e,this.y=t,this.r=i,this.velX=l,this.velY=s,this.speedchange=sc}update(){if((this.velX>0&&this.x+this.r>=width||this.velX<0&&this.x-this.r<=0)&&(this.velX*=-1),this.velY<0&&this.y-this.r<=0&&(this.velY*=-1),this.velY>0&&this.y+this.r>=height)return!1;for(let e=paddles.length-1;e>=0;e--)if(this.x+this.r+this.velX>paddles[e].x&&this.x+this.velX<paddles[e].x+paddles[e].width&&this.y+this.r>paddles[e].y&&this.y<paddles[e].y+paddles[e].height&&(this.velX*=-1),this.x+this.r>paddles[e].x&&this.x<paddles[e].x+paddles[e].width&&this.y+this.r+this.velY>paddles[e].y&&this.y+this.velY<paddles[e].y+paddles[e].height&&(this.velY*=-1,paddles[e]instanceof Paddle)){Score+=10,ph+=1,random(-1,1)<0?this.velX>0?this.velX+=this.speedchange:this.velX-=this.speedchange:this.velY>0?this.velY+=this.speedchange:this.velY-=this.speedchange}}move(){this.x+=this.velX,this.y+=this.velY}display(){ellipse(this.x,this.y,2*this.r,2*this.r)}}function keyTyped(){"r"===key&&(console.log("r"),window.localStorage.HighScore=0)}function keyPressed(){keyCode===ENTER&&location.reload()}function h(){fetch("../gamehandler/highscoreinsert.php?ga=1&is="+HighScore+"&sc="+Score+"&ph="+ph+"&pn="+PlayerName,{method:"GET"}).then(e=>{console.log(e)}).catch(e=>console.log(JSON.parse(JSON.stringify(e))))}class Paddle{constructor(e,t,i,l){this.x=e,this.y=t,this.width=i,this.height=l}move(){(keyIsDown(LEFT_ARROW)||keyIsDown(65))&&this.x>0?this.x-=ps:(keyIsDown(RIGHT_ARROW)||keyIsDown(68))&&this.x+this.width<width&&(this.x+=ps)}display(){rect(this.x,this.y,this.width,this.height)}}